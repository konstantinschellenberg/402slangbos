a.trn = st_area(trn) %>% sum / 1000000
a.study_area
a.trn
pie.data
crp.complex
pie.data
crp.complex
pie.data = crp.complex %>%
st_set_geometry(NULL) %>%
group_by(a) %>%
summarise(count = st_area()) %>%
`colnames<-`(c("CropType", "count"))
pie.data = crp.complex %>%
st_set_geometry(NULL) %>%
group_by(a) %>%
summarise(area = st_area) %>%
`colnames<-`(c("CropType", "area"))
pie.data = crp.complex %>%
st_set_geometry(NULL) %>%
group_by(a) %>%
summarise(area = st_area()) %>%
`colnames<-`(c("CropType", "area"))
pie.data
crp.complex
pie.data = crp.complex %>%
group_by(a) %>%
summarise(area = st_area()) %>%
`colnames<-`(c("CropType", "area"))
pie.data = crp.complex %>%
group_by(a) %>%
summarise(area = st_area())
pie.data = crp.complex %>%
group_by(a)
crp.complex %>%
group_by(a) %>%
summarise(area = st_area())
crp.complex %>%
group_by(a) %>%
summarise(area = st_area())
crp.complex %>%
group_by(a) %>%
summarise(n())
crp.complex %>%
group_by(a) %>%
summarise(cound = n()) %>%
mutate(area = st_area())
crp.complex %>%
group_by(a) %>%
summarise(cound = n()) %>%
mutate(area = st_area(.))
crp.complex %>%
group_by(a) %>%
mutate(area = st_area(.)) %>%
`colnames<-`(c("CropType", "area"))
crp.complex %>%
group_by(a) %>%
summarise(count = n()) %>%
mutate(area = st_area(.)) %>%
st_set_geometry(NULL)
pie.data = crp.complex %>%
group_by(a) %>%
summarise(count = n()) %>%
mutate(area = st_area(.)) %>%
st_set_geometry(NULL) %>%
`colnames<-`(c("CropType", "count", "area"))
pie.data
pie.data[[9, 1]] = "Unclassified"
print(pie.data)
pie.data$CropType = with(pie.data, reorder(CropType, count))
pie.data$CropType = with(pie.data, reorder(CropType, area))
pie.data
pie.data[[9, 1]] = "Unclassified"
print(pie.data)
pie.data$CropType = with(pie.data, reorder(CropType, area))
pie.data
# Compute the position of labels
pie.data <- pie.data %>%
mutate(prop = count / sum(pie.data$count) *100) %>%
mutate(ypos = cumsum(prop)- 0.5*prop) %>%
arrange(CropType)
pie.data
# piechart
gg.pie = ggplot(pie.data, aes(x="", y=prop, fill=CropType)) +
geom_bar(stat="identity", width=1, color="white") +
coord_polar("y", start=0, direction = -1) +
# geom_text(aes(y = ypos, label = prop), color = "black", size=3)+
scale_fill_brewer(palette="RdYlGn") +
theme(legend.position="none") +
theme_void() # remove background, grid, numeric labels
# Compute the position of labels
pie.data <- pie.data %>%
mutate(prop = area / sum(pie.data$area) *100) %>%
mutate(ypos = cumsum(prop)- 0.5*prop) %>%
arrange(CropType)
pie.data
# piechart
gg.pie = ggplot(pie.data, aes(x="", y=area, fill=CropType)) +
geom_bar(stat="identity", width=1, color="white") +
coord_polar("y", start=0, direction = -1) +
# geom_text(aes(y = ypos, label = prop), color = "black", size=3)+
scale_fill_brewer(palette="RdYlGn") +
theme(legend.position="none") +
theme_void() # remove background, grid, numeric labels
gg.pie
# piechart
gg.pie = ggplot(pie.data, aes(x="", y=prop, fill=CropType)) +
geom_bar(stat="identity", width=1, color="white") +
coord_polar("y", start=0, direction = -1) +
# geom_text(aes(y = ypos, label = prop), color = "black", size=3)+
scale_fill_brewer(palette="RdYlGn") +
theme(legend.position="none") +
theme_void() # remove background, grid, numeric labels
gg.pie
pie.data
pie.data = crp.complex %>%
group_by(a) %>%
summarise(count = n()) %>%
mutate(area = st_area(.)) %>%
st_set_geometry(NULL) %>%
`colnames<-`(c("CropType", "count", "area"))
pie.data[[9, 1]] = "Unclassified"
print(pie.data)
pie.data$area = as.numeric(pie.data$area)
pie.data
print(pie.data)
pie.data$CropType = with(pie.data, reorder(CropType, area))
# Compute the position of labels
pie.data <- pie.data %>%
mutate(prop = area / sum(pie.data$area) *100) %>%
mutate(ypos = cumsum(prop)- 0.5*prop) %>%
arrange(CropType)
# piechart
gg.pie = ggplot(pie.data, aes(x="", y=area, fill=CropType)) +
geom_bar(stat="identity", width=1, color="white") +
coord_polar("y", start=0, direction = -1) +
# geom_text(aes(y = ypos, label = prop), color = "black", size=3)+
scale_fill_brewer(palette="RdYlGn") +
theme(legend.position="none") +
theme_void() # remove background, grid, numeric labels
gg.pie
ggsave(filename = "CropTypes2016-17.png", plot = gg.pie, scale = 1, path = "D:/Geodaten/#Jupiter/GEO402/06_plots/croptypes")
# 4) Turnover rates ------------------------------------------------------------
# complex
bar.data.ori = crops_complex %>%
st_set_geometry(NULL) %>%
dplyr::select(c(a, b, c))
bar.data.ori
# 4) Turnover rates ------------------------------------------------------------
# complex
bar.data.ori = crops_complex %>%
dplyr::select(c(a, b, c))
bar.data.ori
summarise("2014-2015" = st_area(.) %>%
a = bar.data.ori %>%
group_by(a) %>%
summarise("2014-2015" = st_area(.)) %>%
rename(CropType = a)
a = bar.data.ori %>%
group_by(a) %>%
summarise("2014-2015" = st_area()) %>%
rename(CropType = a)
bar.data.ori
a = bar.data.ori %>%
group_by(a) %>%
summarise("2014-2015" = n()) %>%
rename(CropType = a)
a
%>%
a = bar.data.ori %>%
group_by(a) %>%
summarise("2014-2015" = n()) %>%
rename(CropType = a) %>%
mutate(area = st_area(.))
a
b = bar.data.ori %>%
group_by(b) %>%
summarise("2015-2016" = n()) %>%
rename(CropType = b) %>%
mutate(area = st_area(.))
c = bar.data.ori %>%
group_by(c) %>%
summarise("2016-2017" = n()) %>%
rename(CropType = c) %>%
mutate(area = st_area(.))
bar.data.reduced = reduce(list(a, b, c), left_join, by = "CropType")
bar.data.reduced
year = map_df(list(a, b, c), ~ st_set_geometry(.x, NULL))
yeaer
year
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
year
bar.data.reduced = reduce(year, left_join, by = "CropType")
bar.data.reduced
bar.data.reduced[[9, 1]] = "Unclassified"
a = bar.data.ori %>%
group_by(a) %>%
summarise(count = n()) %>%
rename("2014-2015" = a) %>%
mutate(area = st_area(.))
b = bar.data.ori %>%
group_by(b) %>%
summarise(count = n()) %>%
rename("2015-2016" = b) %>%
mutate(area = st_area(.))
c = bar.data.ori %>%
group_by(c) %>%
summarise(count = n()) %>%
rename("2016-2017" = c) %>%
mutate(area = st_area(.))
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
bar.data.reduced = reduce(year, left_join, by = "CropType")
bar.data.reduced[[9, 1]] = "Unclassified"
bar.data_complex = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "count")
bar.data.reduced
year
a = bar.data.ori %>%
group_by(a) %>%
summarise(count = n()) %>%
rename(CropType = a) %>%
mutate("2014-2015" = st_area(.))
b = bar.data.ori %>%
group_by(b) %>%
summarise(count = n()) %>%
rename(CropType = b) %>%
mutate("2015-2016" = st_area(.))
c = bar.data.ori %>%
group_by(c) %>%
summarise(count = n()) %>%
rename(CropType = c) %>%
mutate("2016-2017" = st_area(.))
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
year
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
bar.data.reduced = reduce(year, left_join, by = "CropType")
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
bar.data.reduced = reduce(year, left_join, by = "CropType")
bar.data.reduced
bar.data.reduced[[9, 1]] = "Unclassified"
bar.data.reduced
bar.data_complex = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "count")
bar.data.reduced %>% select(-starts_with("count"))
bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_complex = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "count")
bar.data_complex
bar.data.ori = crops_simple %>%
dplyr::select(c(a, b, c))
a = bar.data.ori %>%
group_by(a) %>%
summarise(count = n()) %>%
rename(CropType = a) %>%
mutate("2014-2015" = st_area(.))
b = bar.data.ori %>%
group_by(b) %>%
summarise(count = n()) %>%
rename(CropType = b) %>%
mutate("2015-2016" = st_area(.))
c = bar.data.ori %>%
group_by(c) %>%
summarise(count = n()) %>%
rename(CropType = c) %>%
mutate("2016-2017" = st_area(.))
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
bar.data.reduced = reduce(year, left_join, by = "CropType")
bar.data.reduced[[9, 1]] = "Unclassified"
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_simple = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "count")
# simple
bar.data.ori = crop %>%
dplyr::select(c(a, b, c))
bar.data.ori
bar.data.ori = crop %>%
dplyr::select(c(a, b, c))
a = bar.data.ori %>%
group_by(a) %>%
summarise(count = n()) %>%
rename(CropType = a) %>%
mutate("2014-2015" = st_area(.))
b = bar.data.ori %>%
group_by(b) %>%
summarise(count = n()) %>%
rename(CropType = b) %>%
mutate("2015-2016" = st_area(.))
c = bar.data.ori %>%
group_by(c) %>%
summarise(count = n()) %>%
rename(CropType = c) %>%
mutate("2016-2017" = st_area(.))
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
bar.data.reduced = reduce(year, left_join, by = "CropType")
bar.data.reduced[[9, 1]] = "Unclassified"
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_simple = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "count")
bar.data.reduced[[4, 1]] = "Unclassified"
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_simple = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "count")
bar.data_simple
bar.data_complex
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_complex = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "area")
bar.data_complex
bar.data_complex$area = as.factor(bar.data_complex$area)
bar.data_complex = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "area")
bar.data_complex$area = as.numeric(bar.data_complex$area)
bar.data_complex
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_simple = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "area")
bar.data_simple$area = as.numeric(bar.data_simple$area)
bar.data_simple
# Stacked + percent
gg.bar1 = ggplot(bar.data_simple, aes(fill=CropType, y=count, x=year)) +
geom_bar(position="fill", stat="identity") +
scale_fill_brewer(palette="RdYlGn") +
ylab("percentage")
gg.bar2 = ggplot(bar.data_complex, aes(fill=CropType, y=count, x=year)) +
geom_bar(position="fill", stat="identity") +
scale_fill_brewer(palette="RdYlGn") +
ylab("percentage")
gg.bar1
# Stacked + percent
gg.bar1 = ggplot(bar.data_simple, aes(fill=CropType, y=area, x=year)) +
geom_bar(position="fill", stat="identity") +
scale_fill_brewer(palette="RdYlGn") +
ylab("percentage")
gg.bar1
gg.bar2 = ggplot(bar.data_complex, aes(fill=CropType, y=area, x=year)) +
geom_bar(position="fill", stat="identity") +
scale_fill_brewer(palette="RdYlGn") +
ylab("percentage")
gg.bar2
mplex
bar.data.ori = crops_complex %>%
dplyr::select(c(a, b, c))
a = bar.data.ori %>%
group_by(a) %>%
summarise(count = n()) %>%
rename(CropType = a) %>%
mutate("2014-2015" = st_area(.))
b = bar.data.ori %>%
group_by(b) %>%
summarise(count = n()) %>%
rename(CropType = b) %>%
mutate("2015-2016" = st_area(.))
c = bar.data.ori %>%
group_by(c) %>%
summarise(count = n()) %>%
rename(CropType = c) %>%
mutate("2016-2017" = st_area(.))
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
bar.data.reduced = reduce(year, left_join, by = "CropType")
bar.data.reduced[[9, 1]] = "Unclassified"
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_complex = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "area")
bar.data_complex$area = as.numeric(bar.data_complex$area)
# simple
bar.data.ori = crop %>%
dplyr::select(c(a, b, c))
a = bar.data.ori %>%
group_by(a) %>%
summarise(count = n()) %>%
rename(CropType = a) %>%
mutate("2014-2015" = st_area(.))
b = bar.data.ori %>%
group_by(b) %>%
summarise(count = n()) %>%
rename(CropType = b) %>%
mutate("2015-2016" = st_area(.))
c = bar.data.ori %>%
group_by(c) %>%
summarise(count = n()) %>%
rename(CropType = c) %>%
mutate("2016-2017" = st_area(.))
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
bar.data.reduced = reduce(year, left_join, by = "CropType")
bar.data.reduced[[4, 1]] = "Unclassified"
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_simple = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "area")
bar.data_simple$area = as.numeric(bar.data_simple$area)
# . . . and many more analyses!
# Stacked + percent
gg.bar1 = ggplot(bar.data_simple, aes(fill=CropType, y=area, x=year)) +
geom_bar(position="fill", stat="identity") +
scale_fill_brewer(palette="RdYlGn") +
ylab("percentage")
gg.bar1
gg.bar2 = ggplot(bar.data_complex, aes(fill=CropType, y=area, x=year)) +
geom_bar(position="fill", stat="identity") +
scale_fill_brewer(palette="RdYlGn") +
ylab("percentage")
gg.bar2
ggsave(plot = gg.bar1, filename = "CropTurnover_simple.png", path = "D:/Geodaten/#Jupiter/GEO402/06_plots/croptypes", scale = 1)
ggsave(plot = gg.bar2, filename = "CropTurnover_complex.png", path = "D:/Geodaten/#Jupiter/GEO402/06_plots/croptypes", scale = 1)
bar.data_simple
library(sf)
library(tidyverse)
library(leaflet)
library(leafem)
library(mapview)
library(TRAMPR)
library(ggplot2)
options(max.print = 100)
source("D:/Geodaten/Master/projects/402slangbos/import.R")
env = "D:/Geodaten/#Jupiter/GEO402"
setwd(env)
data = st_read("02_features/Ladybrand_CropData.gpkg", layer = "CropClassifiedSimplified")
# simplified turnover data (Crop, Pasture, Fallow, NA)
turnover = st_read("02_features/Ladybrand_CropData.gpkg", layer = "CropClassifiedSimplifiedTurnover")
crop = st_read("02_features/Ladybrand_CropData.gpkg", layer = "CropClassifiedSimplified")
turnover_complex = st_read("02_features/Ladybrand_CropData.gpkg", layer = "CropClassifiedTurnovers")
crops_complex = st_read("02_features/Ladybrand_CropData.gpkg", layer = "CropClassifiedComplex")
turnover %>% group_by(cat) %>% arrange(a) %>% print(n=200)
str(turnover)
trn = distinct(turnover, .keep_all = TRUE) %>% st_zm()
crop = distinct(crops, .keep_all = TRUE) %>% st_zm()
trn.complex = distinct(turnover_complex, .keep_all = TRUE) %>% st_zm()
crp.complex = distinct(crops_complex, .keep_all = TRUE) %>% st_zm()
print(trn, n = 200)
crop = st_read("02_features/Ladybrand_CropData.gpkg", layer = "CropClassifiedSimplified")
turnover_complex = st_read("02_features/Ladybrand_CropData.gpkg", layer = "CropClassifiedTurnovers")
crops_complex = st_read("02_features/Ladybrand_CropData.gpkg", layer = "CropClassifiedComplex")
turnover %>% group_by(cat) %>% arrange(a) %>% print(n=200)
str(turnover)
trn = distinct(turnover, .keep_all = TRUE) %>% st_zm()
crop = distinct(crops, .keep_all = TRUE) %>% st_zm()
trn.complex = distinct(turnover_complex, .keep_all = TRUE) %>% st_zm()
crp.complex = distinct(crops_complex, .keep_all = TRUE) %>% st_zm()
print(trn, n = 200)
print(crop, n = 200)
print(trn.complex, n = 200)
print(crp.complex, n = 200)
a.study_area = st_area(study_area) / 1000000
a.trn = st_area(trn) %>% sum / 1000000
a.trn / a.study_area # 0.2561339 ~ 25%
pie.data
pie.data = crp.complex %>%
group_by(a) %>%
summarise(count = n()) %>%
mutate(area = st_area(.)) %>%
st_set_geometry(NULL) %>%
`colnames<-`(c("CropType", "count", "area"))
pie.data[[9, 1]] = "Unclassified"
pie.data$area = as.numeric(pie.data$area)
print(pie.data)
pie.data$CropType = with(pie.data, reorder(CropType, area))
# Compute the position of labels
pie.data <- pie.data %>%
mutate(prop = area / sum(pie.data$area) *100) %>%
mutate(ypos = cumsum(prop)- 0.5*prop) %>%
arrange(CropType)
# 4) Turnover rates ------------------------------------------------------------
# complex
bar.data.ori = crops_complex %>%
dplyr::select(c(a, b, c))
a = bar.data.ori %>%
group_by(a) %>%
summarise(count = n()) %>%
rename(CropType = a) %>%
mutate("2014-2015" = st_area(.))
b = bar.data.ori %>%
group_by(b) %>%
summarise(count = n()) %>%
rename(CropType = b) %>%
mutate("2015-2016" = st_area(.))
c = bar.data.ori %>%
group_by(c) %>%
summarise(count = n()) %>%
rename(CropType = c) %>%
mutate("2016-2017" = st_area(.))
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
bar.data.reduced = reduce(year, left_join, by = "CropType")
bar.data.reduced[[9, 1]] = "Unclassified"
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_complex = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "area")
bar.data_complex$area = as.numeric(bar.data_complex$area)
# simple
bar.data.ori = crop %>%
dplyr::select(c(a, b, c))
a = bar.data.ori %>%
group_by(a) %>%
summarise(count = n()) %>%
rename(CropType = a) %>%
mutate("2014-2015" = st_area(.))
b = bar.data.ori %>%
group_by(b) %>%
summarise(count = n()) %>%
rename(CropType = b) %>%
mutate("2015-2016" = st_area(.))
c = bar.data.ori %>%
group_by(c) %>%
summarise(count = n()) %>%
rename(CropType = c) %>%
mutate("2016-2017" = st_area(.))
year = map(list(a, b, c), ~ st_set_geometry(.x, NULL))
bar.data.reduced = reduce(year, left_join, by = "CropType")
bar.data.reduced[[4, 1]] = "Unclassified"
bar.data.reduced = bar.data.reduced %>% dplyr::select(-starts_with("count"))
bar.data_simple = pivot_longer(bar.data.reduced, -CropType, names_to = "year", values_to = "area")
bar.data_simple$area = as.numeric(bar.data_simple$area)
# piechart
gg.pie = ggplot(pie.data, aes(x="", y=area, fill=CropType)) +
geom_bar(stat="identity", width=1, color="white") +
coord_polar("y", start=0, direction = -1) +
# geom_text(aes(y = ypos, label = prop), color = "black", size=3)+
scale_fill_brewer(palette="RdYlGn") +
theme(legend.position="none") +
theme_void() # remove background, grid, numeric labels
gg.pie
pie.data
bar.data_simple
# saving pie data
saveRDS(bar.data_complex, "D:/Geodaten/#Jupiter/GEO402/03_develop/croptypes/crop_type_complex.rds")
saveRDS(bar.data_simple, "D:/Geodaten/#Jupiter/GEO402/03_develop/croptypes/crop_type_simple.rds")
